# Seal 密钥服务器

## 项目概述

Seal 是一个去中心化的密钥管理系统，专为 Sui 区块链平台设计。该项目实现了基于身份的加密（Identity-Based Encryption, IBE）和阈值密钥共享（Threshold Secret Sharing），使用户能够安全地加密和解密数据，同时不依赖于单一的中心化密钥服务器。

## 架构组件

项目分为以下主要组件：

### 1. 密码学核心 (crypto)

位于 `crates/crypto` 目录下，实现了核心加密算法和协议：

- **身份基础加密 (IBE)** - 允许使用用户身份作为公钥进行加密
- **阈值密钥共享 (TSS)** - 实现秘密分享机制，要求多个服务器协作才能恢复密钥
- **数据加密机制 (DEM)** - 提供对称加密功能，包括 AES-256-GCM 和 HMAC-SHA3-256 
- **ElGamal 加密** - 用于密钥服务器和客户端之间的安全通信

### 2. 密钥服务器 (key-server)

位于 `crates/key-server` 目录下，提供 API 接口，验证用户请求并分发解密密钥：

- **服务器管理** - 管理密钥服务器的生命周期和状态
- **请求验证** - 验证用户权限和请求有效性
- **PTB 验证** - 确保可编程交易块（Programmable Transaction Blocks）符合安全策略
- **缓存系统** - 优化性能的请求和响应缓存
- **指标收集** - 监控服务器性能和健康状态

### 3. 命令行工具 (seal-cli)

位于 `crates/seal-cli` 目录下，提供了一个命令行界面，用于：

- **密钥生成** - 创建主密钥和公钥
- **用户密钥提取** - 为特定用户ID生成密钥
- **加密/解密操作** - 支持多种加密模式（Plain、AES、HMAC）
- **密钥验证** - 验证用户密钥的有效性

### 4. 智能合约 (move)

位于 `move` 目录下，包含了 Sui Move 智能合约实现：

- **密钥服务器合约** - 在链上管理密钥服务器身份和状态
- **多项式计算** - 支持阈值加密所需的有限域多项式运算
- **GF256 实现** - 在 Move 中实现 GF(256) 有限域算法
- **加密工具** - 包括 HMAC、KDF 等加密原语

## 工作流程

1. **加密过程**:
   - 生成随机基础密钥
   - 使用阈值密钥共享将基础密钥分割成多个份额
   - 使用IBE为每个密钥服务器加密一个份额
   - 使用派生的对称密钥加密用户数据

2. **解密过程**:
   - 用户向多个密钥服务器请求密钥份额
   - 密钥服务器验证用户身份和权限
   - 用户收集足够多的份额（达到阈值）后重构密钥
   - 使用重构的密钥解密数据

## 安全特性

- **去中心化** - 没有单点故障，需要至少阈值数量的服务器才能解密
- **访问控制** - 基于 Sui 交易验证的精细权限控制
- **前向安全性** - 密钥泄露不会影响之前加密的数据
- **抗重放攻击** - 通过会话密钥和时间戳防止重放攻击

## 部署要求

- 支持 Rust 构建环境
- Sui 全节点访问
- 用于指标监控的 Prometheus（可选）

## 更多资源

有关详细的API参考和使用示例，请参考各个组件中的文档。 